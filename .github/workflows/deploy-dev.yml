name: Deploy dev (Test)

on:
  push:
    branches:
      - dev

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    outputs:
      modules: ${{ steps.detect.outputs.modules }}
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2 # –ù—É–∂–Ω–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–º–∏—Ç–∞–º–∏

      - name: üîç Detect changed modules
        id: detect
        uses: tj-actions/changed-files@v45
        with:
          files: |
            common/**
            adminPanelService/**
            userService/**
            archiveService/**
            notificationService/**
            authService/**
            checkService/**
            checkRenderService/**
            billingService/**
            supportService/**
          json: true # –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

      - name: üìã Output changed modules
        id: set-modules
        run: |
          echo "üîç –°—ã—Ä–æ–π –≤—ã–≤–æ–¥ all_changed_files: ${{ steps.detect.outputs.all_changed_files }}"

          if [ -z "${{ steps.detect.outputs.all_changed_files }}" ]; then
            echo "modules=[]" >> $GITHUB_OUTPUT
            echo "üîç –í—ã—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä modules: []"
          else
            clean_json=$(echo '${{ steps.detect.outputs.all_changed_files }}')

            # –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∫–∞–≤—ã—á–∫–∏) ‚Üí –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
            if echo "$clean_json" | grep -q '^"'; then
              clean_json="[$clean_json]"
            fi

            echo "üîç –û—á–∏—â–µ–Ω–Ω—ã–π JSON: $clean_json"
            echo "$clean_json" > temp.json

            modules=$(jq -r '[.[] | select(test("^(common|adminPanelService|userService|archiveService|notificationService|authService|checkService|checkRenderService|billingService|supportService)/")) | split("/")[0]] | unique' temp.json)

            echo "modules=$modules" >> $GITHUB_OUTPUT
            echo "üîç –í—ã—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä modules: $modules"
          fi
  

  deploy-common:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'common')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync common module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./common/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/common/

      - name: Build common module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/common
            mvn clean -U
            mvn package
          EOF

  deploy-adminPanelService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'adminPanelService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync adminPanelService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./adminPanelService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/adminPanelService/

      - name: Build adminPanelService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/adminPanelService
            mvn clean -U
            mvn package
          EOF

      - name: Restart adminPanelService
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -ex
            cd ${{ secrets.DEPLOY_DEV_PATH }}
            sudo pm2 delete adminPanelService-dev || true
            sudo pm2 start ecosystem.backend.config.js --only adminPanelService-dev
            sudo pm2 save
          EOF

  deploy-userService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'userService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync userService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./userService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/userService/

      - name: Build userService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/userService
            mvn clean -U
            mvn package
          EOF

      - name: Restart userService
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -ex
            cd ${{ secrets.DEPLOY_DEV_PATH }}
            sudo pm2 delete userService-dev || true
            sudo pm2 start ecosystem.backend.config.js --only userService-dev
            sudo pm2 save
          EOF

  deploy-archiveService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'archiveService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync archiveService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./archiveService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/archiveService/

      - name: Build archiveService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/archiveService
            mvn clean -U
            mvn package
          EOF

  deploy-notificationService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'notificationService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync notificationService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./notificationService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/notificationService/

      - name: Build notificationService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/notificationService
            mvn clean -U
            mvn package
          EOF

  deploy-authService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'authService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync authService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./authService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/authService/

      - name: Build authService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/authService
            mvn clean -U
            mvn package
          EOF

      - name: Restart authService
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -ex
            cd ${{ secrets.DEPLOY_DEV_PATH }}
            sudo pm2 delete authService-dev || true
            sudo pm2 start ecosystem.backend.config.js --only authService-dev
            sudo pm2 save
          EOF

  deploy-checkService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'checkService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync checkService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./checkService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/checkService/

      - name: Build checkService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/checkService
            mvn clean -U
            mvn package
          EOF

  deploy-checkRenderService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'checkRenderService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync checkRenderService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./checkRenderService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/checkRenderService/

      - name: Build checkRenderService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/checkRenderService
            mvn clean -U
            mvn package
          EOF

  deploy-billingService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'billingService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync billingService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./billingService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/billingService/

      - name: Build billingService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/billingService
            mvn clean -U
            mvn package
          EOF

      - name: Restart billingService
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -ex
            cd ${{ secrets.DEPLOY_DEV_PATH }}
            sudo pm2 delete billingService-dev || true
            sudo pm2 start ecosystem.backend.config.js --only billingService-dev
            sudo pm2 save
          EOF

  deploy-supportService:
    needs: detect-changes
    if: contains(fromJson(needs.detect-changes.outputs.modules), 'supportService')
    runs-on: ubuntu-latest
    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üîê Setup SSH agent
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: üß™ Debug ssh-agent
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö SSH-–∫–ª—é—á–µ–π:"
          ssh-add -l || echo "‚ùå –ö–ª—é—á–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

      - name: üß± Add server to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H ${{ secrets.SERVER_IP }} >> ~/.ssh/known_hosts
        continue-on-error: false

      - name: üîå Test SSH connection
        run: |
          echo "üîó –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
          ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} "echo ‚úÖ SSH connection established"

      - name: Sync supportService module to server
        run: |
          rsync -avz --delete --exclude .idea --exclude target ./supportService/ ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }}:${{ secrets.DEPLOY_DEV_PATH }}/supportService/

      - name: Build supportService module on server
        run: |
          ssh ${{ secrets.SSH_USER }}@${{ secrets.SERVER_IP }} << 'EOF'
            set -e
            cd ${{ secrets.DEPLOY_DEV_PATH }}/supportService
            mvn clean -U
            mvn package
          EOF
